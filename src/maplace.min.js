;(function(e,m,f){'use strict';var l,h;l={activateCurrent:function(a){this.html_element.find("select").val(a)},getHtml:function(){var a=this,b="",c;if(1<this.ln){b+='<select class="dropdown controls '+this.o.controls_cssclass+'">';this.ShowOnMenu(this.view_all_key)&&(b+='<option value="'+this.view_all_key+'">'+this.o.view_all_text+"</option>");for(c=0;c<this.ln;c+=1)this.ShowOnMenu(c)&&(b+='<option value="'+(c+1)+'">'+(this.o.locations[c].title||"#"+(c+1))+"</option>");b=e(b+"</select>").bind("change",function(){a.ViewOnMap(this.value)})}(c=
this.o.controls_title)&&(c=e('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",fontSize:this.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.o.controls_title));return this.html_element=e('<div class="wrap_controls"></div>').append(c).append(b)}};h={html_a:function(a,b,c){var g=this;b=b||a+1;c=c||this.o.locations[a].title;a=e('<a data-load="'+b+'" id="ullist_a_'+b+'" href="#'+b+'" title="'+c+'"><span>'+(c||"#"+(a+1))+"</span></a>");a.css(this.o.controls_applycss?
{color:"#666",display:"block",padding:"5px",fontSize:this.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{});a.on("click",function(a){a.preventDefault();a=e(this).attr("data-load");g.ViewOnMap(a)});return a},activateCurrent:function(a){this.html_element.find("li").removeClass("active");this.html_element.find("#ullist_a_"+a).parent().addClass("active")},getHtml:function(){var a=e("<ul class='ullist controls "+this.o.controls_cssclass+"'></ul>").css(this.o.controls_applycss?{margin:0,padding:0,
listStyleType:"none"}:{}),b;this.ShowOnMenu(this.view_all_key)&&a.append(e("<li></li>").append(h.html_a.call(this,!1,this.view_all_key,this.o.view_all_text)));for(b=0;b<this.ln;b++)this.ShowOnMenu(b)&&a.append(e("<li></li>").append(h.html_a.call(this,b)));(b=this.o.controls_title)&&(b=e('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.o.controls_on_map?"12px":"inherit"}:{}).append(this.o.controls_title));return this.html_element=
e('<div class="wrap_controls"></div>').append(b).append(a)}};var d=function(a){this.VERSION="0.1.0";this.errors=[];this.initialized=!1;this.dev=!0;this.markers=[];this.oMap=!1;this.infowindow=null;this.ln=0;this.oMap=!1;this.current_index=this.current_control=this.controls_wrapper=this.canvas_map=this.map_div=this.oBounds=null;this.view_all_key="all";this.markers=[];this.directionsDisplay=this.directionsService=this.Polygon=this.Polyline=null;this.o={map_div:"#gmap",controls_div:"#controls",generate_controls:!0,
controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:!0,controls_applycss:!0,controls_position:f.maps.ControlPosition.RIGHT_TOP,type:"marker",view_all:!0,view_all_text:"View All",start:0,locations:[],commons:{},map_options:{mapTypeId:f.maps.MapTypeId.ROADMAP,zoom:1},stroke_options:{strokeColor:"#0000FF",strokeOpacity:0.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:0.4},directions_options:{travelMode:f.maps.TravelMode.DRIVING,unitSystem:f.maps.UnitSystem.METRIC,optimizeWaypoints:!1,
provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1},directions_panel:null,draggable:!1,show_infowindows:!0,show_markers:!0,infowindow_type:"bubble",beforeViewAll:function(){},afterViewAll:function(){},beforeShowCurrent:function(){},afterShowCurrent:function(){},afterCreateMarker:function(){},beforeCloseInfowindow:function(){},afterCloseInfowindow:function(){},beforeOpenInfowindow:function(){},afterOpenInfowindow:function(){},afterRoute:function(){},onPolylineClick:function(){}};this.AddControl("dropdown",
l);this.AddControl("list",h);this._init(a,!0)};d.prototype._init=function(a){e.extend(!0,this.o,a);this.ln=this.o.locations.length;for(a=0;a<this.ln;a++)e.extend(this.o.locations[a],this.o.commons),this.o.locations[a].html&&(this.o.locations[a].html=this.o.locations[a].html.replace("%index",a+1),this.o.locations[a].html=this.o.locations[a].html.replace("%title",this.o.locations[a].title||""))};d.prototype.controls={};d.prototype.create_objMap=function(){if(this.initialized)this.oMap.setOptions(this.o.map_options);
else try{this.map_div.css({position:"relative",overflow:"hidden"}),this.canvas_map=e("<div>").addClass("canvas_map").css({width:this.map_div.width(),height:this.map_div.height()}).appendTo(this.map_div),this.oMap=new f.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(a){this.errors.push(a.toString())}this.debug("01")};d.prototype.add_markers_to_objMap=function(){var a;a=this.o.type||"marker";switch(a){case "marker":for(a=0;a<this.ln;a++)this.create.marker.call(this,a);break;default:this.create[a].apply(this)}};
d.prototype.create={marker:function(a){var b=this,c=this.o.locations[a],g,d,j=new f.maps.LatLng(c.lat,c.lon),k=!1===c.visible?!1:!0;e.extend(c,{position:j,map:this.oMap,zIndex:1E4,visible:!1===this.o.show_markers?!1:k});c.image&&(image_w=c.image_w||32,image_h=c.image_h||32,e.extend(c,{icon:new f.maps.MarkerImage(c.image,new f.maps.Size(image_w,image_h),new f.maps.Point(0,0),new f.maps.Point(image_w/2,image_h/2))}));g=new f.maps.Marker(c);f.maps.event.addListener(g,"click",function(){b.o.beforeShowCurrent(a,
c,g);d=!1===c.show_infowindows?!1:!0;b.o.show_infowindows&&d&&b.open_infowindow(a,g);b.oMap.panTo(j);c.zoom&&b.oMap.setZoom(c.zoom);b.current_control&&(b.o.generate_controls&&b.current_control.activateCurrent)&&b.current_control.activateCurrent.call(b,a+1);b.current_index=a;b.o.afterShowCurrent(a,c,g)});this.oBounds.extend(j);this.markers.push(g);this.o.afterCreateMarker(a,c,g);c.visible=k;return g},polyline:function(){var a,b,c=[];for(a=0;a<this.ln;a++)b=new f.maps.LatLng(this.o.locations[a].lat,
this.o.locations[a].lon),c.push(b),this.create.marker.call(this,a);e.extend(this.o.stroke_options,{path:c,map:this.oMap});this.Polyline?this.Polyline.setOptions(this.o.stroke_options):this.Polyline=new f.maps.Polyline(this.o.stroke_options)},polygon:function(){var a=this,b,c,g=[];for(b=0;b<this.ln;b++)c=new f.maps.LatLng(this.o.locations[b].lat,this.o.locations[b].lon),g.push(c),this.create.marker.call(this,b);e.extend(this.o.stroke_options,{paths:g,editable:this.o.draggable,map:this.oMap});this.Polygon?
this.Polygon.setOptions(this.o.stroke_options):this.Polygon=new f.maps.Polygon(this.o.stroke_options);f.maps.event.addListener(this.Polygon,"click",function(b){a.o.onPolylineClick(b)})},directions:function(){var a=this,b,c,g,d,j,k=[],h=0;for(b=0;b<this.ln;b++)g=new f.maps.LatLng(this.o.locations[b].lat,this.o.locations[b].lon),0===b?d=g:b===this.ln-1?j=g:(c=!0===this.o.locations[b].stopover?!0:!1,k.push({location:g,stopover:c})),this.create.marker.call(this,b);e.extend(this.o.directions_options,{origin:d,
destination:j,waypoints:k});this.directionsService||(this.directionsService=new f.maps.DirectionsService);this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new f.maps.DirectionsRenderer({draggable:this.o.draggable});this.directionsDisplay.setMap(this.oMap);this.o.directions_panel&&(this.o.directions_panel=e(this.o.directions_panel),this.directionsDisplay.setPanel(this.o.directions_panel.get(0)));this.o.draggable&&f.maps.event.addListener(this.directionsDisplay,
"directions_changed",function(){h=a.compute_distance(a.directionsDisplay.directions);a.o.afterRoute(h)});this.directionsService.route(this.o.directions_options,function(b,c){c==f.maps.DirectionsStatus.OK&&(h=a.compute_distance(b),a.directionsDisplay.setDirections(b));a.o.afterRoute(h,c,b)})}};d.prototype.compute_distance=function(a){var b=0,c=a.routes[0],d=c.legs.length;for(a=0;a<d;a++)b+=c.legs[a].distance.value;return b};d.prototype.type_to_open={bubble:function(a){this.infowindow=new f.maps.InfoWindow({content:a.html||
""})}};d.prototype.open_infowindow=function(a,b){this.CloseInfoWindow();var c=this.o.locations[a],d=c.type||this.o.infowindow_type;c.html&&this.type_to_open[d]&&(this.o.beforeOpenInfowindow(a,c,b),this.type_to_open[d].call(this,c),this.infowindow.open(this.oMap,b),this.o.afterOpenInfowindow(a,c,b))};d.prototype.get_html_controls=function(){return this.controls[this.o.controls_type]&&this.controls[this.o.controls_type].getHtml?(this.current_control=this.controls[this.o.controls_type],this.current_control.getHtml.apply(this)):
""};d.prototype.generate_controls=function(){if(this.o.controls_on_map){var a=e('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.controls_applycss?{margin:"5px"}:{}),b=e(this.get_html_controls()).css(this.o.controls_applycss?{background:"#fff",padding:"5px",border:"1px solid rgb(113,123,135)",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 4px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});a.append(b);this.oMap.controls[this.o.controls_position].push(a.get(0))}else this.controls_wrapper.empty(),
this.controls_wrapper.append(this.get_html_controls())};d.prototype.reset_map=function(){var a=this,b=0;this.Polyline&&this.Polyline.setMap(null);this.Polygon&&this.Polygon.setMap(null);this.directionsDisplay&&this.directionsDisplay.setMap(null);if(this.markers){for(b in this.markers)if(this.markers[b])try{this.markers[b].setMap(null)}catch(c){a.errors.push(c)}this.markers.length=0;this.markers=[]}this.o.controls_on_map&&this.oMap.controls&&this.oMap.controls[this.o.controls_position].forEach(function(b,
c){a.oMap.controls[this.o.controls_position].removeAt(c)});this.oBounds=new f.maps.LatLngBounds;this.debug("02")};d.prototype.perform_load=function(){1==this.ln?this.ViewOnMap(1):0===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new f.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.oMap.fitBounds(this.oBounds),this.oMap.setZoom(this.o.map_options.zoom)):(this.oMap.fitBounds(this.oBounds),"number"==typeof(this.o.start-0)&&0<this.o.start&&this.o.start<=
this.ln?this.ViewOnMap(this.o.start):this.ViewOnMap(this.view_all_key))};d.prototype.debug=function(a){this.dev&&this.errors.length&&console.log(a+": ",this.errors)};d.prototype.AddControl=function(a,b){if(!a||!b)return!1;this.controls[a]=b;return!0};d.prototype.CloseInfoWindow=function(){if(this.infowindow&&(this.current_index||0===this.current_index))this.o.beforeCloseInfowindow(this.current_index,this.o.locations[this.current_index]),this.infowindow.close(),this.infowindow=null,this.o.afterCloseInfowindow(this.current_index,
this.o.locations[this.current_index])};d.prototype.ShowOnMenu=function(a){if(a==this.view_all_key&&this.o.view_all&&1<this.ln)return!0;a=parseInt(a,10);return"number"==typeof(a-0)&&(0<=a&&a<this.ln)&&!1!==this.o.locations[a].visible?!0:!1};d.prototype.ViewOnMap=function(a){if(a==this.view_all_key)this.o.beforeViewAll(),this.current_index=a,0<this.o.locations.length&&(this.o.generate_controls&&this.current_control&&this.current_control.activateCurrent)&&this.current_control.activateCurrent.apply(this,
[a]),this.oMap.fitBounds(this.oBounds),this.CloseInfoWindow(),this.o.afterViewAll();else if(a=parseInt(a,10),"number"==typeof(a-0)&&0<a&&a<=this.ln)try{f.maps.event.trigger(this.markers[a-1],"click")}catch(b){this.errors.push(b.toString())}this.debug("03")};d.prototype.SetLocations=function(a,b){this.o.locations=a;b&&this.Load()};d.prototype.AddLocations=function(a,b){var c=this;e.isArray(a)&&e.each(a,function(a,b){c.o.locations.push(b)});e.isPlainObject(a)&&this.o.locations.push(a);b&&this.Load()};
d.prototype.RemoveLocations=function(a,b){var c=this,d=0;e.isArray(a)?e.each(a,function(a,b){b-d<c.ln&&c.o.locations.splice(b-d,1);d++}):a<this.ln&&this.o.locations.splice(a,1);b&&this.Load()};d.prototype.Load=function(a){this._init(a);this.map_div=e(this.o.map_div);this.controls_wrapper=e(this.o.controls_div);this.reset_map();this.create_objMap();this.add_markers_to_objMap();1<this.ln&&this.o.generate_controls?this.generate_controls():this.o.generate_controls=!1;var b=this;this.initialized?this.perform_load():
f.maps.event.addListenerOnce(this.oMap,"idle",function(){b.perform_load()});f.maps.event.addListener(this.oMap,"resize",function(){b.canvas_map.css({width:b.map_div.width(),height:b.map_div.height()})});this.initialized=!0};"function"==typeof define&&define.amd?define(function(){return d}):m.Maplace=d})(jQuery,this,google);
(function(f,e,a,undefined){'use strict';var b,c,d;b=(function(){function h(i){this.Locate=i;this.html_element=null}h.prototype.activateCurrent=function(i){this.html_element.find("select").val(i)};h.prototype.getHtml=function(){var j=this,k="",l,i;if(this.Locate.ln>1){k+='<select class="dropdown controls '+this.Locate.o.controls_cssclass+'">';if(this.Locate.ShowOnMenu(this.Locate.view_all_key)){k+='<option value="'+this.Locate.view_all_key+'">'+this.Locate.o.view_all_text+"</option>"}for(i=0;i<this.Locate.ln;i+=1){if(this.Locate.ShowOnMenu(i)){k+='<option value="'+(i+1)+'">'+(this.Locate.o.locations[i].title||("#"+(i+1)))+"</option>"}}k+="</select>";k=f(k).bind("change",function(){j.Locate.ViewOnMap(this.value)})}l=this.Locate.o.controls_title;if(this.Locate.o.controls_title){l=f('<div class="controls_title"></div>').css(this.Locate.o.apply_style?{fontWeight:"bold",fontSize:this.Locate.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.Locate.o.controls_title)}this.html_element=f('<div class="wrap_controls"></div>').append(l).append(k);return this.html_element};return h})();c=(function(){function h(i){this.Locate=i;this.html_element=null}h.prototype.html_a=function(l,n,o){var j=this,k=n||(l+1),o=o||this.Locate.o.locations[l].title,m=f('<a data-load="'+k+'" id="ullist_a_'+k+'" href="#'+k+'" title="'+o+'"><span>'+(o||("#"+(l+1)))+"</span></a>");m.css(this.Locate.o.apply_style?{color:"#666",display:"block",padding:"5px",fontSize:this.Locate.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{});m.on("click",function(q){q.preventDefault();var p=f(this).attr("data-load");j.Locate.ViewOnMap(p)});return m};h.prototype.activateCurrent=function(i){this.html_element.find("li").removeClass("active");this.html_element.find("#ullist_a_"+i).parent().addClass("active")};h.prototype.getHtml=function(){var j=f("<ul class='ullist controls "+this.Locate.o.controls_cssclass+"'></ul>").css(this.Locate.o.apply_style?{margin:0,padding:0,listStyleType:"none"}:{}),k,i=0;if(this.Locate.ShowOnMenu(this.Locate.view_all_key)){j.append(f("<li></li>").append(this.html_a(false,this.Locate.view_all_key,this.Locate.o.view_all_text)))}for(i;i<this.Locate.ln;i++){if(this.Locate.ShowOnMenu(i)){j.append(f("<li></li>").append(this.html_a(i)))}}k=this.Locate.o.controls_title;if(this.Locate.o.controls_title){k=f('<div class="controls_title"></div>').css(this.Locate.o.apply_style?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.Locate.o.controls_on_map?"12px":"inherit"}:{}).append(this.Locate.o.controls_title)}this.html_element=f('<div class="wrap_controls"></div>').append(k).append(j);return this.html_element};return h})();d=(function(){function h(i){this.errors=[];this.initialized=false;this.dev=true;this.infowindow;this.ln=0;this.oMap=false;this.oBounds=null;this.map_div=null;this.canvas_map=null;this.gm_active=false;this.controls_wrapper;this.current_control;this.current_index;this.view_all_key="all";this.markers=[];this.Polyline=null;this.Polygon=null;this.directionsService=null;this.directionsDisplay=null;this.o={map_div:"#gmap",controls_div:"#controls",generate_controls:true,controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:true,type:"marker",view_all:true,view_all_text:"View All",start:0,locations:[],commons:{},map_options:{mapTypeId:a.maps.MapTypeId.ROADMAP,zoom:1},stroke_options:{strokeColor:"#0000FF",strokeOpacity:0.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:0.4},directions_options:{travelMode:a.maps.TravelMode.DRIVING,unitSystem:a.maps.UnitSystem.METRIC,optimizeWaypoints:false,provideRouteAlternatives:false,avoidHighways:false,avoidTolls:false},directions_panel:null,draggable:false,show_infowindows:true,show_markers:true,infowindow_type:"bubble",apply_style:true,beforeViewAll:function(){},afterViewAll:function(){},beforeShowCurrent:function(k,j,l){},afterShowCurrent:function(k,j,l){},afterCreateMarker:function(k,j,l){},beforeCloseInfowindow:function(k,j,l){},afterCloseInfowindow:function(k,j,l){},beforeOpenInfowindow:function(k,j,l){},afterOpenInfowindow:function(k,j,l){},afterRoute:function(l,k,j){},onPolylineClick:function(j){}};this.AddControl("dropdown",b);this.AddControl("list",c);this._init(i,true)}h.prototype._init=function(k,j){f.extend(true,this.o,k);this.ln=this.o.locations.length;for(var l=0;l<this.ln;l++){f.extend(this.o.locations[l],this.o.commons)}};h.prototype.controls={};h.prototype.create_objMap=function(){var i=this;if(!this.gm_active){this.gm_active=true;try{this.map_div.css({position:"relative",overflow:"hidden"});this.canvas_map=f("<div>").addClass("canvas_map").css({width:this.map_div.width(),height:this.map_div.height()}).appendTo(this.map_div);this.oMap=new a.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(j){this.errors.push(j.toString())}}else{i.oMap.setOptions(this.o.map_options)}this.debug("Locate.create_objMap")};h.prototype.add_markers_to_objMap=function(){var i=0,j=this.o.type||"marker";switch(j){case"marker":for(i;i<this.ln;i++){this.create.marker.apply(this,[i])}break;default:this.create[j].apply(this);break}};h.prototype.create={marker:function(m){var q=this,p=this.o.locations[m],l=p.html||"",k,o,n,i=new a.maps.LatLng(p.lat,p.lon),j=p.visible===false?false:true;f.extend(p,{position:i,map:this.oMap,zIndex:10000,visible:(this.o.show_markers===false?false:j)});if(p.image){image_w=p.image_w||32;image_h=p.image_h||32;f.extend(p,{icon:new a.maps.MarkerImage(p.image,new a.maps.Size(image_w,image_h),new a.maps.Point(0,0),new a.maps.Point(image_w/2,image_h/2))})}k=new a.maps.Marker(p);o=a.maps.event.addListener(k,"click",function(){q.o.beforeShowCurrent(m,k,l);n=p.show_infowindows===false?false:true;if(q.o.show_infowindows&&n){q.open_infowindow(m,k,{content:l,type:p.type||q.o.infowindow_type,oMap:q.oMap})}q.oMap.panTo(i);if(p.zoom){q.oMap.setZoom(p.zoom)}if(q.current_control&&q.o.generate_controls){q.current_control.activateCurrent(m+1)}q.current_index=m;q.o.afterShowCurrent(m,k,l)});this.oBounds.extend(i);this.markers.push(k);this.o.afterCreateMarker(m,k,l);p.visible=j;return k},polyline:function(){var j=this,i,l,k=[];for(i=0;i<this.ln;i++){l=new a.maps.LatLng(this.o.locations[i].lat,this.o.locations[i].lon);k.push(l);this.create.marker.apply(this,[i])}f.extend(this.o.stroke_options,{path:k,map:this.oMap});this.Polyline?this.Polyline.setOptions(this.o.stroke_options):this.Polyline=new a.maps.Polyline(this.o.stroke_options)},polygon:function(){var j=this,i,l,k=[];for(i=0;i<this.ln;i++){l=new a.maps.LatLng(this.o.locations[i].lat,this.o.locations[i].lon);k.push(l);this.create.marker.apply(this,[i])}f.extend(this.o.stroke_options,{paths:k,editable:this.o.draggable,map:this.oMap});this.Polygon?this.Polygon.setOptions(this.o.stroke_options):this.Polygon=new a.maps.Polygon(this.o.stroke_options);a.maps.event.addListener(this.Polygon,"click",function(m){j.o.onPolylineClick(m)})},directions:function(){var l=this,j,m,p,k,i,o=[],n=0;for(j=0;j<this.ln;j++){p=new a.maps.LatLng(this.o.locations[j].lat,this.o.locations[j].lon);if(j===0){k=p}else{if(j===(this.ln-1)){i=p}else{m=this.o.locations[j].stopover===true?true:false;o.push({location:p,stopover:m})}}this.create.marker.apply(this,[j])}f.extend(this.o.directions_options,{origin:k,destination:i,waypoints:o});this.directionsService||(this.directionsService=new a.maps.DirectionsService());this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new a.maps.DirectionsRenderer({draggable:this.o.draggable});this.directionsDisplay.setMap(this.oMap);if(this.o.directions_panel){this.o.directions_panel=f(this.o.directions_panel);this.directionsDisplay.setPanel(this.o.directions_panel.get(0))}if(this.o.draggable){a.maps.event.addListener(this.directionsDisplay,"directions_changed",function(){n=l.compute_distance(l.directionsDisplay.directions);l.o.afterRoute(n)})}this.directionsService.route(this.o.directions_options,function(q,r){if(r==a.maps.DirectionsStatus.OK){n=l.compute_distance(q);l.directionsDisplay.setDirections(q)}l.o.afterRoute(n,r,q)})}};h.prototype.compute_distance=function(j){var m=0,l,k=j.routes[0],n=k.legs.length;for(l=0;l<n;l++){m+=k.legs[l].distance.value}return m};h.prototype.type_to_open={bubble:function(j,i){j.infowindow=new a.maps.InfoWindow(i)}};h.prototype.open_infowindow=function(k,i,j){this.CloseInfoWindow();if(j.content){if(this.type_to_open[j.type||this.o.infowindow_type]){this.o.beforeOpenInfowindow(k,i,j.content);this.type_to_open[j.type||this.o.infowindow_type](this,j);this.infowindow.open(this.oMap,i);this.o.afterOpenInfowindow(k,i,j.content)}}};h.prototype.get_html_controls=function(){this.current_control=new this.controls[this.o.controls_type](this);if(this.controls[this.o.controls_type]){return this.current_control.getHtml()}return""};h.prototype.generate_controls=function(){if(!this.o.controls_on_map){this.controls_wrapper.empty();this.controls_wrapper.append(this.get_html_controls());return}var j=f('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.apply_style?{margin:"5px"}:{}),i=f(this.get_html_controls()).css(this.o.apply_style?{background:"#fff",padding:"5px",border:"1px solid rgb(113,123,135)",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 4px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});j.append(i);this.oMap.controls[a.maps.ControlPosition.RIGHT_TOP].push(j.get(0))};h.prototype.reset_map=function(){var j=this,k=0;if(this.Polyline){this.Polyline.setMap(null)}if(this.Polygon){this.Polygon.setMap(null)}if(this.directionsDisplay){this.directionsDisplay.setMap(null)}if(this.markers){for(k in this.markers){if(this.markers[k]){try{this.markers[k].setMap(null)}catch(l){j.errors.push(l)}}}this.markers.length=0;this.markers=[]}if(this.o.controls_on_map&&this.oMap.controls){this.oMap.controls[a.maps.ControlPosition.RIGHT_TOP].forEach(function(m,i){j.oMap.controls[a.maps.ControlPosition.RIGHT_TOP].removeAt(i)})}this.oBounds=new a.maps.LatLngBounds();this.debug("Locate.reset_map")};h.prototype.perform_load=function(){if(this.ln==1){this.ViewOnMap(1)}else{if(this.ln===0){if(this.o.map_options.set_center){this.oMap.setCenter(new a.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1]))}else{this.oMap.fitBounds(this.oBounds)}this.oMap.setZoom(this.o.map_options.zoom)}else{this.oMap.fitBounds(this.oBounds);if(typeof(this.o.start-0)=="number"&&this.o.start>0&&this.o.start<=this.ln){this.ViewOnMap(this.o.start)}else{this.ViewOnMap(this.view_all_key)}}}};h.prototype.debug=function(i){if(this.dev&&this.errors.length){console.log(i+": ",this.errors)}};h.prototype.AddControl=function(i,j){if(!i){return false}j=j||function(){};this.controls[i]=j;return true};h.prototype.CloseInfoWindow=function(){if(this.infowindow&&(this.current_index||this.current_index===0)){this.o.beforeCloseInfowindow(this.current_index);this.infowindow.close();this.infowindow=null;this.o.afterCloseInfowindow(this.current_index)}};h.prototype.ShowOnMenu=function(i){if(i==this.view_all_key&&this.o.view_all&&this.ln>1){return true}i=parseInt(i,10);if(typeof(i-0)=="number"&&i>=0&&i<this.ln){var j=this.o.locations[i].visible===false?false:true;if(j){return true}}return false};h.prototype.ViewOnMap=function(i){if(i==this.view_all_key){this.o.beforeViewAll();this.current_index=i;if(this.o.locations.length>0&&this.o.generate_controls){this.current_control.activateCurrent(i);this.oMap.fitBounds(this.oBounds)}else{this.oMap.fitBounds(this.oBounds)}this.CloseInfoWindow();this.o.afterViewAll()}else{i=parseInt(i,10);if(typeof(i-0)=="number"&&i>0&&i<=this.ln){try{a.maps.event.trigger(this.markers[i-1],"click")}catch(j){this.errors.push(j.toString())}}}this.debug("Locate.ViewOnMap")};h.prototype.SetLocations=function(j,i){this.o.locations=j;if(i){this.Load()}};h.prototype.AddLocations=function(k,j){var i=this;if(f.isArray(k)){f.each(k,function(l,m){i.o.locations.push(m)})}if(f.isPlainObject(k)){this.o.locations.push(k)}if(j){this.Load()}};h.prototype.RemoveLocations=function(m,l){var j=this,i=0;if(f.isArray(m)){f.each(m,function(k,n){if((n-i)<j.ln){j.o.locations.splice(n-i,1)}i++})}else{if(m<this.ln){this.o.locations.splice(m,1)}}if(l){this.Load()}};h.prototype.Load=function(j){this._init(j);this.map_div=f(this.o.map_div);this.controls_wrapper=f(this.o.controls_div);this.reset_map();this.create_objMap();this.add_markers_to_objMap();if(this.ln>1&&this.o.generate_controls){this.generate_controls()}else{this.o.generate_controls=false}var i=this;if(!this.initialized){a.maps.event.addListenerOnce(this.oMap,"idle",function(){i.perform_load()})}else{this.perform_load()}a.maps.event.addListener(this.oMap,"resize",function(){i.canvas_map.css({width:i.map_div.width(),height:i.map_div.height()})});this.initialized=true};return h})();if(typeof define=="function"&&define.amd){define(function(){return d})}else{e.Locate=d}})(jQuery,this,google);